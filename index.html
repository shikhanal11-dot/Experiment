<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login â€¢ Study Quest</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* All your original CSS untouched */
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --text: #0f172a;
      --text-light: #475569;
      --border: #d1d5db;
      --bg: #f9fafb;
      --card: #ffffff;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --radius: 8px;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:'Inter',sans-serif;
      background:var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1rem;
      color:var(--text);
    }
    .login-container{width:100%;max-width:400px;margin:0 auto;}
    .login-card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid var(--border);
      overflow:hidden;
      transition:0.4s ease;
      padding-bottom:1rem;
    }
    .login-header{text-align:center;padding:2rem 2rem 1rem;}
    .logo{
      width:48px;height:48px;background:var(--primary);
      border-radius:var(--radius);margin:0 auto 1rem;
      display:flex;align-items:center;justify-content:center;
      color:white;font-size:24px;font-weight:700;
    }
    .login-title{font-size:1.875rem;font-weight:600;margin-bottom:0.25rem;}
    .login-subtitle{color:var(--text-light);font-size:0.875rem;}
    .login-form{padding:0 2rem 1rem;}
    .form-group{margin-bottom:1.25rem;}
    label{display:block;margin-bottom:0.5rem;font-weight:500;}
    input{
      width:100%;
      padding:0.75rem 1rem;
      border:1px solid var(--border);
      border-radius:var(--radius);
      font-size:1rem;
      background:var(--card);
    }
    input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(37,99,235,0.1);
      outline:none;
    }
    .login-btn{
      width:100%;padding:0.75rem;
      background:var(--primary);color:white;
      border:none;border-radius:var(--radius);
      font-size:1rem;font-weight:600;
      cursor:pointer;
    }
    .login-btn:hover{background:var(--primary-hover);}
    .signup-prompt{text-align:center;padding:1rem 2rem;font-size:0.875rem;color:var(--text-light);}
    .signup-link{color:var(--primary);cursor:pointer;font-weight:500;}

    /* Hidden signup fields */
    .signup-fields{display:none; animation: fadeIn 0.3s ease;}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
  </style>
</head>

<body>
  <div class="login-container">
    <div class="login-card">

      <div class="login-header">
        <div class="logo">S</div>
        <h1 class="login-title" id="formTitle">Welcome Back</h1>
        <p class="login-subtitle" id="formSubtitle">Sign in to your Study Quest account</p>
      </div>

      <form class="login-form" id="mainForm">
        
        <!-- Email -->
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="email" required />
        </div>

        <!-- Password -->
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" required minlength="8" />
        </div>

        <!-- SIGNUP-ONLY FIELDS -->
        <div class="signup-fields" id="signupFields">

          <div class="form-group">
            <label>Grade</label>
            <input type="number" id="grade" placeholder="e.g. 10" />
          </div>

          <div class="form-group">
            <label>School</label>
            <input type="text" id="school" placeholder="Your School Name" />
          </div>

        </div>

        <button type="submit" class="login-btn" id="submitBtn">Sign In</button>

      </form>

      <div class="signup-prompt">
        <span id="toggleText">New to Study Quest?</span>
        <span class="signup-link" id="toggleLink">Create an account</span>
      </div>

    </div>
  </div>

  <!-- SUPABASE SCRIPT -->
  <script type="module">
    import { supabase } from "./supabase-init.js";
    console.log("Supabase Initialized:", supabase);

    const mainForm = document.getElementById("mainForm");
    const signupFields = document.getElementById("signupFields");
    const formTitle = document.getElementById("formTitle");
    const formSubtitle = document.getElementById("formSubtitle");
    const toggleLink = document.getElementById("toggleLink");
    const toggleText = document.getElementById("toggleText");
    const submitBtn = document.getElementById("submitBtn");

    let isSignup = false;

    // ðŸ”„ TOGGLE BETWEEN LOGIN & SIGNUP
    toggleLink.addEventListener("click", () => {
      isSignup = !isSignup;

      if (isSignup) {
        signupFields.style.display = "block";
        formTitle.textContent = "Create Account";
        formSubtitle.textContent = "Join Study Quest today";
        submitBtn.textContent = "Sign Up";
        toggleText.textContent = "Already have an account?";
        toggleLink.textContent = "Sign In";
      } else {
        signupFields.style.display = "none";
        formTitle.textContent = "Welcome Back";
        formSubtitle.textContent = "Sign in to your Study Quest account";
        submitBtn.textContent = "Sign In";
        toggleText.textContent = "New to Study Quest?";
        toggleLink.textContent = "Create an account";
      }
    });

    // ðŸŸ¦ FORM SUBMIT
    mainForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!isSignup) {
        // ðŸ” LOGIN
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) return alert("Login failed: " + error.message);

        window.location.href = "dashboard.html";
        return;
      }

      // ðŸ†• SIGNUP MODE
      const grade = document.getElementById("grade").value;
      const school = document.getElementById("school").value;

      const { data: authData, error: authError } = await supabase.auth.signUp({
        email,
        password,
      });

      if (authError) return alert("Signup failed: " + authError.message);

      const user = authData.user;

      // Insert into profiles table
      const { error: profileErr } = await supabase.from("Profiles").insert({
        id: user.id,
        email,
        grade,
        school,
        points: 0
      });

      if (profileErr) return alert("Error creating profile: " + profileErr.message);

      alert("Account created successfully!");
      window.location.href = "dashboard.html";
    });

    window.onload = () => document.getElementById("email").focus();
  </script>

</body>
</html>
