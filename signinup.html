<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Quest • Login</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

 <style>
  :root {
    --bg: #FFE3A9;          /* background */
    --accent1: #8CCDEB;     /* borders / soft accents */
    --accent2: #725CAD;     /* primary accent */
    --accent3: #0B1D51;     /* darker gradient color */
    --text: #0B1D51;        /* deep navy for readability */
    --radius: 12px;
    --shadow-soft: 0 8px 22px rgba(0, 0, 0, 0.12);
    --shadow-hover: 0 12px 28px rgba(0, 0, 0, 0.15);
    --error-color: #FF4D4F;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: "Inter", sans-serif;
    background: linear-gradient(135deg, #ffe6fa, #e3f4ff, #e7ffe6);
    background-size: 400% 400%;
    animation: gradientShift 12s ease infinite;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 1rem;
    color: var(--text);
  }
  
/* Background Gradient Animation */
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}


  .card {
    background: #fff;
    width: 100%;
    max-width: 420px;
    padding: 2.2rem;
    border-radius: var(--radius);
    border: 2px solid var(--accent1);
    box-shadow: var(--shadow-soft);
    transition: 0.25s ease;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
  }

  .brand {
    display: flex;
    align-items: center;
    margin-bottom: 1.8rem;
    gap: 0.7rem;
    justify-content: center;
  }

  .brand-logo {
    width: 46px;
    height: 46px;
    background: var(--accent2);
    color: white;
    font-weight: 700;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
  }

  .brand-name {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--accent3);
  }

  h1 {
    text-align: center;
    font-size: 1.7rem;
    margin-bottom: 0.3rem;
    color: var(--accent3);
    font-weight: 700;
  }

  p.subtitle {
    text-align: center;
    color: var(--text);
    opacity: 0.8;
    margin-bottom: 1.6rem;
    font-size: 0.95rem;
  }

  .form-group { margin-bottom: 1.15rem; }

  label {
    font-weight: 600;
    font-size: 0.92rem;
    margin-bottom: 0.35rem;
    display: block;
    color: var(--text);
  }

  input {
    width: 100%;
    padding: 0.85rem;
    border: 2px solid var(--accent1);
    border-radius: var(--radius);
    font-size: 1rem;
    background: #ffffffcc;
    transition: 0.2s;
  }

  input:focus {
    border-color: var(--accent2);
    outline: none;
    box-shadow: 0 0 0 4px rgba(114,92,173,0.25);
  }

  .primary-btn {
    width: 100%;
    padding: 0.9rem;
    background: linear-gradient(135deg, var(--accent2), var(--accent3));
    color: white;
    border: none;
    border-radius: var(--radius);
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .primary-btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-hover);
  }

  .primary-btn::after {
    content: "";
    position: absolute;
    top: -50%;
    left: -20%;
    width: 250%;
    height: 200%;
    background: linear-gradient(120deg, transparent, #ffffff85, transparent);
    transform: rotate(25deg);
    animation: shine 2.4s infinite;
  }

  @keyframes shine {
    0% { transform: translateX(-120%) rotate(25deg); }
    100% { transform: translateX(200%) rotate(25deg); }
  }

  .toggle-password {
    cursor: pointer;
    font-size: 0.85rem;
    color: var(--accent2);
    float: right;
    font-weight: 600;
    margin-top: -28px;
    margin-right: 8px;
    position: relative;
    z-index: 2;
  }

  .divider {
    text-align: center;
    color: var(--text);
    margin: 1.2rem 0;
    position: relative;
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .divider:before, .divider:after {
    content: "";
    position: absolute;
    top: 50%;
    width: 38%;
    height: 1px;
    background: var(--accent1);
  }

  .divider:before { left: 0; }
  .divider:after { right: 0; }

  .social {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.3rem;
  }

  .social-btn {
    flex: 1;
    padding: 0.7rem;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: 0.2s;
    font-size: 0.95rem;
  }

  .google-btn {
    background: #fff;
    border: 1px solid var(--accent1);
  }

  .apple-btn {
    background: var(--text);
    color: #fff;
  }

  .toggle-auth {
    text-align: center;
    margin-top: 0.6rem;
    font-size: 0.9rem;
  }

  .toggle-auth span {
    color: var(--accent2);
    cursor: pointer;
    font-weight: 600;
  }

  .signup-fields { display: none; }
</style>

</head>

<body>
  

  <div class="card">
    <div class="brand">
      <div class="brand-logo">S</div>
      <div class="brand-name">Study Quest</div>
    </div>

    <h1 id="formTitle">Welcome Back</h1>
    <p class="subtitle" id="formSubtitle">Ready for your next quest?</p>

    <form id="authForm">
      
      <!-- name --> 
      <div class="signup-fields form-group">
        <label>Enter Your Name</label>
        <input type="text" id="name">
      </div>

    

      <!-- Email -->
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="email" required>
      </div>

      <!-- Password -->
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" required>
        <span class="toggle-password" onclick="togglePass()">Show</span>
      </div>

      <!-- Signup-only fields -->
      <div class="signup-fields form-group">
        <label>Grade</label>
        <input type="number" id="grade">
      </div>

      <div class="signup-fields form-group">
        <label>School</label>
        <input type="text" id="school">
      </div>

      <button class="primary-btn" type="submit" id="submitBtn">Start Quest</button>
    </form>

    <div class="divider">or</div>

    <div class="social">
      <button class="social-btn google-btn">Google</button>
      <button class="social-btn apple-btn">Apple ID</button>
    </div>

    <p class="toggle-auth">
      <span id="toggleLink">Create an account</span>
    </p>
  </div>

  <!-- SUPABASE SCRIPT -->
  <script type="module">
    import { supabase } from "./supabase-init.js";
    console.log("Supabase initialized:", supabase);

    const signupFields = document.querySelectorAll(".signup-fields");
    const toggleLink = document.getElementById("toggleLink");
    const formTitle = document.getElementById("formTitle");
    const formSubtitle = document.getElementById("formSubtitle");
    const submitBtn = document.getElementById("submitBtn");
    const authForm = document.getElementById("authForm");

    let isSignup = false;

    function togglePass() {
      const pass = document.getElementById("password");
      const toggle = document.querySelector(".toggle-password");
      pass.type = pass.type === "password" ? "text" : "password";
      toggle.textContent = pass.type === "password" ? "Show" : "Hide";
    }
    window.togglePass = togglePass;

    // Toggle Login ↔ Signup
    toggleLink.addEventListener("click", () => {
      isSignup = !isSignup;

      signupFields.forEach(f => f.style.display = isSignup ? "block" : "none");

      if (isSignup) {
        formTitle.textContent = "Create Your Account";
        formSubtitle.textContent = "Join the adventure!";
        submitBtn.textContent = "Sign Up";
        toggleLink.textContent = "Already have an account?";
      } else {
        formTitle.textContent = "Welcome Back";
        formSubtitle.textContent = "Ready for your next quest?";
        submitBtn.textContent = "Start Quest";
        toggleLink.textContent = "Create an account";
      }
    });

    // Form Submit Handler
    authForm.addEventListener("submit", async e => {
      e.preventDefault();

      let email = document.getElementById("email").value.trim();
      let password = document.getElementById("password").value.trim();

      if (!isSignup) {
        // LOGIN
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) return alert("Login failed: " + error.message);
        return (window.location.href = "dashboard.html");
      }

      // SIGNUP
      let name = document.getElementById("name").value.trim();
      let grade = document.getElementById("grade").value.trim();
      let school = document.getElementById("school").value.trim();

      const { data: authData, error: authError } = await supabase.auth.signUp({
        email,
        password,
        options: { 
          emailRedirectTo: window.location.origin
        }
      });

      if (authError) return alert(authError.message);

      let { data: sessionData } = await supabase.auth.getSession();
      let user = sessionData.session?.user;

      if (!user) return alert("Check your email to verify before continuing.");

      let { error: profileError } = await supabase.from("profiles").insert({
        id: user.id,
        email:email,
        username: name,
        grade: grade,
        school: school,
        points: 0,
      });

      if (profileError) return alert(profileError.message);

      alert("Account created! Also Make sure to verify your email.");
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
